!function(n){n.Callbacks=function(e){e=n.extend({},e);var t,i,r,o,s,u,c=[],f=!e.once&&[],l=function(n){for(t=e.memory&&n,i=!0,u=o||0,o=0,s=c.length,r=!0;c&&u<s;++u)if(!1===c[u].apply(n[0],n[1])&&e.stopOnFalse){t=!1;break}r=!1,c&&(f?f.length&&l(f.shift()):t?c.length=0:a.disable())},a={add:function(){if(c){var i=c.length,u=function(t){n.each(t,function(n,t){"function"==typeof t?e.unique&&a.has(t)||c.push(t):t&&t.length&&"string"!=typeof t&&u(t)})};u(arguments),r?s=c.length:t&&(o=i,l(t))}return this},remove:function(){return c&&n.each(arguments,function(e,t){for(var i;(i=n.inArray(t,c,i))>-1;)c.splice(i,1),r&&(i<=s&&--s,i<=u&&--u)}),this},has:function(e){return!(!c||!(e?n.inArray(e,c)>-1:c.length))},empty:function(){return s=c.length=0,this},disable:function(){return c=f=t=void 0,this},disabled:function(){return!c},lock:function(){return f=void 0,t||a.disable(),this},locked:function(){return!f},fireWith:function(n,e){return!c||i&&!f||(e=e||[],e=[n,e.slice?e.slice():e],r?f.push(e):l(e)),this},fire:function(){return a.fireWith(this,arguments)},fired:function(){return!!i}};return a}}(Zepto),function(n){function e(t){var i=[["resolve","done",n.Callbacks({once:1,memory:1}),"resolved"],["reject","fail",n.Callbacks({once:1,memory:1}),"rejected"],["notify","progress",n.Callbacks({memory:1})]],r="pending",o={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return e(function(e){n.each(i,function(i,r){var u=n.isFunction(t[i])&&t[i];s[r[1]](function(){var t=u&&u.apply(this,arguments);if(t&&n.isFunction(t.promise))t.promise().done(e.resolve).fail(e.reject).progress(e.notify);else{var i=this===o?e.promise():this,s=u?[t]:arguments;e[r[0]+"With"](i,s)}})}),t=null}).promise()},promise:function(e){return null!=e?n.extend(e,o):o}},s={};return n.each(i,function(n,e){var t=e[2],u=e[3];o[e[1]]=t.add,u&&t.add(function(){r=u},i[1^n][2].disable,i[2][2].lock),s[e[0]]=function(){return s[e[0]+"With"](this===s?o:this,arguments),this},s[e[0]+"With"]=t.fireWith}),o.promise(s),t&&t.call(s,s),s}var t=Array.prototype.slice;n.when=function(i){var r,o,s,u=t.call(arguments),c=u.length,f=0,l=1!==c||i&&n.isFunction(i.promise)?c:0,a=1===l?i:e(),h=function(n,e,i){return function(o){e[n]=this,i[n]=arguments.length>1?t.call(arguments):o,i===r?a.notifyWith(e,i):--l||a.resolveWith(e,i)}};if(c>1)for(r=new Array(c),o=new Array(c),s=new Array(c);f<c;++f)u[f]&&n.isFunction(u[f].promise)?u[f].promise().done(h(f,s,u)).fail(a.reject).progress(h(f,o,r)):--l;return l||a.resolveWith(s,u),a.promise()},n.Deferred=e}(Zepto);